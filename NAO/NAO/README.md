## CIFAR-10 Without Weight Sharing
### To Search Architectures
| Script | Data | Pairwise Accuracy | Hamming Distance |
| ------------- | ------------- | ------------- | ------------- |
| ./NAO/cnn/epd/train.sh | [`Googel Drive`](https://drive.google.com/open?id=1mjIR33wwV7R6_U1_WQ98uK7al-QlRHtv) [`Biadu Pan`](https://pan.baidu.com/s/1jnjkyLylX1LqiD9m98vRqw)| 78%~80% | 0.0 | 

If you want to try the whole pipeline, please follow the steps:

1. Randomly generate seed architectures, or use the architectures we provide. The architectures should be in json format file.
2. Train the architectures using ```NAO/cnn/train_search_cifar10.sh``` by passing the json file into the ```--arch``` argument.
3. Collect the best valid accuracy of each architecture and put all the numbers within one file.
4. Use ```NAO/cnn/epd/convert_arch_to_seq.py``` to preprocess the data and get (x,y) pair used for NAO.
5. Train the NAO Encoder-Predictor-Decoder using ```NAO/cnn/epd/train.sh```.
6. Sort the architectures by their valid performance and pick out top 100 architectures.
7. Generate new architectures upon the top 100 architectures using ```NAO/cnn/epd/generate.sh```. Set ```--predict_lambda``` to 10, 20, 30 respectively, and get 300 new architectures.
8. Use ```NAO/cnn/epd/convert_seq_to_arch.py``` to postprocess the architectures generated by NAO and translate them back to the json format files.
9. Run the new generated architectures and collect their valid accuracy.
10. Go back to step 3 and loop for several iterations. (Normally, 2 or 3 iterations is enough. Or you can also try more iterations until you find no gain.)
11. Pick out top architectures according to their valid accuracy, and train them from scratch using ```NAO/cnn/train_search_cifar10.sh``` by replacing the ```--arch``` argument with the json format file of the architecture discovered by yourself.

We provide the json format file of NAONet at ```NAO/cnn/dag.NAONet.json``` for example.

### To Train Discovered Architectures
Please download data at [`Google Drive`](https://drive.google.com/open?id=1XcC_cycn1Dog4s_Bki8TV9XZYc1Ast3u) [`Baidu Pan`](https://pan.baidu.com/s/1VS2_K3nAzWZh-JIwVmNyCg)

You can train the best architecture discovered (show in Fig. 1 in the Appendix of the paper) using:

| Dataset | Script | GPU | Time | Checkpoint| Error Rate (Test)|
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
|CIFAR-10| ./NAO/cnn/train_cifar10_final.sh | 2 P40 | 5 days | [`Google Drive`](https://drive.google.com/open?id=1TPgAZB7ZXAxaYmTj8efriJ6IbmSgMJKX) [`Baidu Pan`](https://pan.baidu.com/s/1r8nQIRE7F4jBTEKKqyaZuA)| 2.10% |
|CIFAR-100| ./NAO/cnn/train_cifar100_final.sh | 2 P40 | 5 days | [`Google Drive`](https://drive.google.com/open?id=15eDukFiGoGmqLbZAES826eFem99V_2bI) [`Baidu Pan`](https://pan.baidu.com/s/1r8nQIRE7F4jBTEKKqyaZuA)| 14.80% |

by running:
```
cd NAO/cnn
bash train_cifar10_final.sh
bash train_cifar100_final.sh
```

### To Directly Evaluate an Architecturethe 
To directly evaluate an architecture, for example, our best architecture discovered, please download the checkpoint above, move all the files to ```NAO/cnn/models/cifar10 or NAO/cnn/models/cifar100/ ```, and run:
```
cd NAO/cnn
bash test_cifar10.sh     #This should give you an accuracy of 97.94% (error rate of 2.06%)
bash test_cifar100.sh    #This should give you an accuracy of 85.20% (error rate of 14.81%)
```


## PTB Without Weight Sharing
### To Search Architectures

| Script | Data | Pairwise Accuracy | Hamming Distance |
| ------------- | ------------- | ------------- | ------------- |
| ./NAO/rnn/epd/train.sh | [`Googel Drive`](https://drive.google.com/open?id=1iRCyladgdE-TCD2Cj05ucAr7tzrUVZkq) [`Baidu Pan`](https://pan.baidu.com/s/17UC2CGao352e1axZtdwcSA)| 73%~74% | 0.0 | 

If you want to try the whole pipeline, please follow the steps:

1. Randomly generate seed architectures, or use the architectures we provide.
2. Train the architectures using ```NAO/rnn/train_search_ptb.sh``` by passing the architecture string into the ```--arch``` argument.
3. Collect the best valid ppl of each architecture and put all the numbers within one file.
4. Use ```NAO/rnn/epd/convert_arch_to_seq.py``` to preprocess the data and get (x,y) pair used for NAO.
5. Train the NAO Encoder-Predictor-Decoder using ```NAO/rnn/epd/train.sh```.
6. Sort the architectures by their valid performance and pick out top 100 architectures.
7. Generate new architectures upon the top 100 architectures using ```NAO/rnn/epd/generate.sh```. Set ```--predict_lambda``` to 10, 20, 30 respectively, and get 300 new architectures.
8. Use ```NAO/rnn/epd/convert_seq_to_arch.py``` to postprocess the architectures generated by NAO and translate them back to the string format.
9. Run the new generated architectures and collect their valid ppl.
10. Go back to step 3 and look for several iterations. (Normally, 2 or 3 iterations is enough. Or you can also try more iterations until you find no gain.)
11. Pick out top architectures according to their valid ppl, and train them from scratch using ```NAO/rnn/train_search_ptb.sh``` by replacing the ```--arch``` argument with the string format of the architecture discovered by yourself.

### To Train Discovered Architectures
You can train the best architecture discovered (showin in Fig. 2 in the Appendix of the paper) using:

| Dataset | Script | GPU | Time | Checkpoint| PPL (Test)|
| ------------- | ------------- | ------------- | ------------- | ------------- |------------- |
|PTB| ./NAO/rnn/train_ptb_final.sh | 1 V100 | 4 days | [`Google Drive`](https://drive.google.com/open?id=1o8Nq890szQwlMZDHwzcGhZ3BsnH_sGvT) [`Baidu Pan`](https://pan.baidu.com/s/1jnjkyLylX1LqiD9m98vRqw)| 56.02 |
|WikiText-2| ./NAO/rnn/train_wt2_final.sh | 1 V100 | 4 days | [`Google Drive`](https://drive.google.com/open?id=1N0BbsJPJo02pE2ILfAi_RtLPOJJwBxfu) [`Baidu Pan`](https://pan.baidu.com/s/1jnjkyLylX1LqiD9m98vRqw)| 67.10 |

### To Directly Evaluate an Architecture
To directly evaluate an architecture, for example, our best architecture discovered, please download the checkpoint above, move all the files to ```NAO/rnn/models/ptb or NAO/rnn/models/wt2 ```, and run:
```
cd NAO/rnn
bash test_ptb.sh    #This should give you a test ppl of 56.02
bash test_wt2.sh    #This should give you a test ppl of 67.10
```

